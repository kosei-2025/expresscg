    const orderForm = document.getElementById('orderForm');
    if (orderForm) {
        orderForm.addEventListener('submit', function (e) {
            // 既存のエラークラスをリセット
            const errorFields = orderForm.querySelectorAll('.form-error');
            errorFields.forEach(field => {
                field.classList.remove('form-error');
                if (field.matches('input[type="text"], input[type="email"], textarea')) {
                    field.style.borderColor = 'var(--mid-gray)';
                } else if (field.classList.contains('radio-group') || field.classList.contains('file-upload') || field.classList.contains('agreement-row')) {
                    field.style.border = ''; // もしくは元のスタイルに戻す
                    field.style.outline = '';
                }
            });

            const f = e.target;
            // const miss = []; // 削除
            // const errorElements = []; // 削除

            // お名前
            // const nameInput = f['お名前'];
            // if (!nameInput.value.trim()) { // 削除
            //     miss.push('お名前');
            //     errorElements.push(nameInput);
            // }

            // メールアドレス
            const emailInput = f.email; // メールアドレスの形式チェックは残す場合
            // if (!emailInput.value.trim()) { // 削除 (必須チェック部分)
            //     miss.push('メールアドレス');
            //     errorElements.push(emailInput);
            // } else if (emailInput.value.trim() && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim())) { // 形式チェックは残す
            //     alert('メールアドレスの形式が正しくありません。'); // アラートで通知する例
            //     emailInput.classList.add('form-error');
            //     emailInput.style.borderColor = 'var(--accent)';
            //     e.preventDefault();
            //     return;
            // }
            // もしメールアドレスの形式チェックも不要なら以下の2行も削除
            // else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim())) {
            //     miss.push('メールアドレスの形式');
            //     errorElements.push(emailInput);
            // }

          　// 電話番号
            // const phoneInput = f['電話番号'];
            // if (!phoneInput.value.trim()) { // 削除
            //     miss.push('電話番号');
            //     errorElements.push(phoneInput);
            // }

            // 会社名
            // const companyInput = f['会社名'];
            // if (!companyInput.value.trim()) { // 削除
            //     miss.push('会社名');
            //     errorElements.push(companyInput);
            // }
          
            // プラン
            // if (!f.querySelector('[name="プラン"]:checked')) { // 削除
            //     miss.push('プラン');
            //     const radioGroup = f.querySelector('.radio-group');
            //     if(radioGroup) errorElements.push(radioGroup);
            // }

            // 図面PDF
            const filesInput = f.elements['図面PDF']; // ファイルサイズチェックのために残す
            // if (filesInput && filesInput.files.length === 0) { // 削除
            //     miss.push('図面PDF');
            //     const fileUploadDiv = filesInput.closest('.file-upload');
            //     if(fileUploadDiv) errorElements.push(fileUploadDiv);
            // }

            // 画角メモ
            // const memoInput = f['画角メモ'];
            // if (!memoInput.value.trim()) { // 削除
            //     miss.push('画角メモ');
            //     errorElements.push(memoInput);
            // }

            // 同意チェック
            // const agreements = [ // 削除
            //     { name: '同意_特商法', label: '特定商取引法への同意', element: f.elements['同意_特商法'] },
            //     { name: '同意_利用規約', label: '利用規約への同意', element: f.elements['同意_利用規約'] },
            //     { name: '同意_プライバシーポリシー', label: 'プライバシーポリシーへの同意', element: f.elements['同意_プライバシーポリシー'] }
            // ];
            // agreements.forEach(agreement => { // 削除
            //     if (agreement.element && !agreement.element.checked) {
            //         miss.push(agreement.label);
            //         const agreementRow = agreement.element.closest('.agreement-row');
            //         if(agreementRow) errorElements.push(agreementRow);
            //     }
            // });

            // if (miss.length > 0) { // このifブロック全体を削除またはコメントアウト
            //     e.preventDefault();
            //     alert(`${miss.join('、\n')}が未入力または正しくありません。`);
            //     errorElements.forEach(el => {
            //         el.classList.add('form-error');
            //          if (el.matches('input[type="text"], input[type="email"], textarea')) {
            //             el.style.borderColor = 'var(--accent)';
            //         } else if (el.classList.contains('radio-group')) {
            //             el.style.border = '2px solid var(--accent)';
            //         } else if (el.classList.contains('file-upload')) {
            //             el.style.borderColor = 'var(--accent)';
            //         } else if (el.classList.contains('agreement-row')) {
            //             el.style.outline = '2px solid var(--accent)';
            //             el.style.outlineOffset = '2px';
            //         }
            //     });
            //     const submitButton = orderForm.querySelector('button[type="submit"]');
            //     if (submitButton.disabled) {
            //         submitButton.disabled = false;
            //         submitButton.innerHTML = '今すぐ依頼する <i class="fas fa-arrow-right"></i>';
            //     }
            //     return;
            // }

            // バリデーション成功、AJAX送信処理へ
            e.preventDefault();
            const formData = new FormData(orderForm);
            const submitButton = orderForm.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '送信中... <i class="fas fa-spinner fa-spin"></i>';

            // ファイルサイズチェック (バリデーション成功後に行う)
            if (filesInput && filesInput.files.length > 0) { // filesInput は上で定義されている想定
                const totalBytes = [...filesInput.files].reduce((sum, file) => sum + file.size, 0);
                const limit = 5 * 1024 * 1024; // 5 MB
                if (totalBytes > limit) {
                    alert('ファイルの合計サイズが 5 MB を超えています。\nZIP で圧縮するか、共有リンクをご利用ください。');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    const fileUploadDiv = filesInput.closest('.file-upload');
                    if(fileUploadDiv) {
                        fileUploadDiv.classList.add('form-error');
                        fileUploadDiv.style.borderColor = 'var(--accent)';
                    }
                    return;
                }
            }

            fetch(orderForm.action, {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            })
            .then(response => {
                if (response.ok) return response.json().catch(() => ({ success: true })); // 変更点: JSONパース失敗時も成功扱い
                return response.json().then(errData => { throw new Error(errData.message || JSON.stringify(errData)); })
                                   .catch(() => response.text().then(text => { throw new Error('送信に失敗しました: ' + (response.statusText || text)); }));
            })
            .then(data => { // 変更点: data.success の評価をより堅牢に
                if (data && (data.success === true || (typeof data.success === 'string' && data.success.toLowerCase() === 'true'))) {
                    displayThankYouPage();
                } else {
                    const errorMessage = data && data.message ? data.message : JSON.stringify(data);
                    throw new Error('送信処理でエラーが報告されました: ' + errorMessage);
                }
            })
            .catch(error => {
                console.error('送信エラー:', error);
                alert('フォームの送信中にエラーが発生しました。しばらくしてからもう一度お試しください。\n詳細: ' + error.message);
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            });
        });
    }
